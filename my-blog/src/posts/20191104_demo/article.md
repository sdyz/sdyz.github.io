### ã€è¯‘ã€‘You Might Not Need Redux ä½ ä¹Ÿè®¸ä¸éœ€è¦ Redux

2019 å¹´ 06 æœˆ 06 æ—¥

åŸæ–‡ï¼š <https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367>

ä½œè€…ï¼š[Dan Abramov](https://medium.com/@dan_abramov?source=follow_footer--------------------------follow_footer-) Working on @reactjs. Co-author of Redux and Create React App. Building tools for humans.

äººä»¬ç»å¸¸é€‰æ‹©ä½¿ç”¨ Redux è€Œéæ˜¯éœ€è¦å®ƒã€‚â€œå¦‚æœä¸ä½¿ç”¨çš„è¯ï¼Œä¸‡ä¸€æˆ‘ä»¬çš„ app ä¸èƒ½æ‰©å±•æ€ä¹ˆåŠï¼Ÿâ€ï¼Œéšåï¼Œå¼€å‘è€…ä»¬å¯¹ä»£ç ä¸­å¼•å…¥çš„ Redux æ„Ÿåˆ°ä¸æ»¡ã€‚â€ä¸ºä»€ä¹ˆæˆ‘å¼€å‘ä¸€ä¸ªç®€å•çš„åŠŸèƒ½è¦æ¶‰åŠä¸‰ä¸ªæ–‡ä»¶ï¼Ÿâ€œ åˆ°åº•ä¸ºä»€ä¹ˆï¼

äººä»¬æŠ±æ€¨ Reduxï¼ŒReact ï¼Œå‡½æ•°å¼ç¼–ç¨‹ï¼Œä¸å˜æ€§ï¼Œä»¥åŠå¾ˆå¤šäº‹æƒ…å¸¦æ¥çš„å›°æ‰°ï¼Œæˆ‘æ˜¯å¯ä»¥ç†è§£çš„ã€‚å¾ˆè‡ªç„¶çš„å»å°† Redux å’Œ ä¸éœ€è¦â€œæ ·æ¿ä»£ç â€æ¥æ›´æ–°çŠ¶æ€çš„æ–¹æ³•å»åšå¯¹æ¯”ï¼Œå¹¶å¾—å‡ºç»“è®ºï¼ŒRedux æ˜¯å¤æ‚çš„ã€‚æŸç§ç¨‹åº¦æ¥è¯´ï¼Œæ˜¯è¿™æ ·çš„ï¼Œè®¾è®¡ä¸Šæ¥è®²ä¹Ÿæ˜¯ã€‚

Redux æä¾›ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆï¼Œå®ƒè¦æ±‚ä½ ï¼š

- ç”¨ç®€å•å¯¹è±¡å’Œæ•°ç»„æ¥æè¿°åº”ç”¨çŠ¶æ€
- ç”¨ç®€å•å¯¹è±¡æ¥æè¿°åº”ç”¨ä¸­çš„å˜æ›´
- ç”¨çº¯å‡½æ•°æ¥æè¿°å¤„ç†å˜æ›´çš„é€»è¾‘

å¯¹äºæ„å»ºä¸€ä¸ª app è¿™äº›é™åˆ¶éƒ½ä¸æ˜¯å¿…é¡»çš„ï¼Œæ— è®ºæ˜¯å¦ä½¿ç”¨ Reactã€‚å®é™…ä¸Šè¿™äº›éƒ½æ˜¯å¼ºçº¦æŸï¼Œæ‰€ä»¥ä½ åœ¨é‡‡ç”¨å®ƒä¹‹å‰éœ€è¦ä»”ç»†è®¤çœŸæ€è€ƒï¼Œå³ä¾¿åªæ˜¯ç”¨äº†ä¸€éƒ¨åˆ†ã€‚

æ˜¯å¦æœ‰å¥½çš„ç†ç”±æ¥ä½¿ç”¨å®ƒå‘¢ï¼Ÿ

è¿™äº›é™åˆ¶å¸å¼•ç€æˆ‘æ˜¯å› ä¸ºå®ƒå¸®åŠ©æˆ‘æ„å»ºä¸€ä¸ªè¿™æ ·çš„ appï¼š

- å°†çŠ¶æ€æŒä¹…å‚¨å­˜åœ¨æœ¬åœ°ï¼Œå¹¶æ ¹æ®å®ƒå¯åŠ¨
- é¢„å…ˆæŠŠçŠ¶æ€å­˜è‡³æœåŠ¡å™¨ï¼Œä½¿ç”¨ html å‘é€è‡³å®¢æˆ·ç«¯ï¼Œå¹¶æ ¹æ®å®ƒå¯åŠ¨
- åºåˆ—åŒ–ç”¨æˆ·æ“ä½œï¼Œè¿åŒçŠ¶æ€å¿«ç…§ä¸€èµ·è‡ªåŠ¨çš„ç”Ÿæˆ bug æ—¥å¿—ï¼Œä½¿å¾—äº§å“å¼€å‘è€…å¯ä»¥å¤ç°é”™è¯¯
- é€šè¿‡ç½‘ç»œçš„ action å¯¹è±¡å®ç°ååŒç¯å¢ƒï¼Œå¹¶ä¸éœ€è¦ä»£ç ç¼–å†™çš„å·¨å¤§æ”¹å˜
- ä¿æŒä¸€ä¸ªæ’¤é”€å†å²æˆ–å®ç°æ”¹å˜ï¼Œå¹¶ä¸éœ€è¦ä»£ç ç¼–å†™çš„å·¨å¤§æ”¹å˜
- æ¸¸èµ°äºå¼€å‘ç¯å¢ƒä¸­çš„çŠ¶æ€å†å²ï¼Œä»¥åŠå½“ä»£ç æ”¹å˜æ—¶ï¼Œæ ¹æ®æ“ä½œå†å²é‡æ–°è®¡ç®—å½“å‰çŠ¶æ€ï¼Œa la TDD
- ä¸ºå¼€å‘å·¥å…·æä¾›å®Œæ•´çš„æ£€æŸ¥å’Œæ§åˆ¶èƒ½åŠ›ï¼Œä½¿äº§å“å¼€å‘è€…å¯ä»¥ä¸ºå…¶ app å®šåˆ¶åŒ–å·¥å…·
- æä¾›å¯é€‰çš„ UIï¼Œå½“éœ€è¦é‡ç”¨å¤§é‡çš„ä¸šåŠ¡é€»è¾‘æ—¶

å¦‚æœä½ è¦å¼€å‘çš„æ˜¯ä¸€ä¸ªå¯æ‰©å±•ç»ˆç«¯ã€ä¸€ä¸ª JS è°ƒè¯•å™¨ã€æˆ–è€…ä¸€äº› web åº”ç”¨ï¼Œä¹Ÿè®¸å€¼å¾—ä¸€ç”¨ï¼Œæˆ–è€…è‡³å°‘å€¼å¾—æ€è€ƒä¸€äº›å®ƒçš„æƒ³æ³•ï¼ˆthey are [not](https://github.com/evancz/elm-architecture-tutorial) [new](https://github.com/omcljs/om), by the way!ï¼‰

ç„¶è€Œï¼Œå¦‚æœä½ ä»…ä»…æ˜¯æƒ³å­¦ä¹  Reactï¼Œè¯·ä¸è¦æŠŠ Redux ä½œä¸ºä½ çš„é¦–é€‰ã€‚

å–è€Œä»£ä¹‹ä½ å¯ä»¥å­¦ä¹  React å“²å­¦( [think in React](https://facebook.github.io/react/docs/thinking-in-react.html) ) ã€‚å½“ä½ çœŸçš„éœ€è¦å®ƒçš„æ—¶å€™å†å›æ¥å­¦ä¹ ï¼Œæˆ–è€…ä½ ç°åœ¨å°±åƒå°è¯•ä¸€ä¸‹ä¸€äº›æ–°çš„ä¸œè¥¿ã€‚ä½†è¯·è°¨æ…å¯¹å¾…ï¼Œå°±åƒä½ å¯¹å¾…ä»»ä½•å¼ºé™åˆ¶æ€§å·¥å…·ä¸€æ ·ã€‚

å¦‚æœä½ å¯¹ â€œRedux æ–¹å¼â€ æ„Ÿåˆ°æœ‰å‹åŠ›ï¼Œä¹Ÿè®¸æ˜¯åœ¨å‘Šè¯‰ä½ ï¼Œä½ å’Œä½ çš„å›¢é˜Ÿä½¿ç”¨å®ƒè¿‡äºä¸¥è‚ƒäº†ã€‚å®ƒä»…ä»…æ˜¯ä½ å·¥å…·ç®±ä¸­çš„ä¸€å‘˜ï¼Œä¸€æ¬¡æ›´å¤§èƒ†çš„å°è¯•ã€‚

æœ€åï¼Œä¸è¦å¿˜è®°ä½ å¯ä»¥ä» Redux ä¸­å­¦ä¹ å®ƒçš„æ€æƒ³è€Œéåº”ç”¨å®ƒï¼Œä¾‹å¦‚ï¼Œæ€è€ƒä¸€ä¸ª ä½¿ç”¨æœ¬åœ°çŠ¶æ€çš„ React ç»„ä»¶ï¼š

```jsx
import React, { Component } from 'react';

class Counter extends Component {
  state = { value: 0 };

  increment = () => {
    this.setState(prevState => ({
      value: prevState.value + 1
    }));
  };

  decrement = () => {
    this.setState(prevState => ({
      value: prevState.value - 1
    }));
  };

  render() {
    return (
      <div>
        {this.state.value}
        <button onClick={this.increment}>+</button>
        <button onClick={this.decrement}>-</button>
      </div>
    );
  }
}
```

è¿™ç§ä½¿ç”¨æ–¹å¼å¾ˆå¥½ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå®ƒéœ€è¦é‡å¤ä½¿ç”¨ã€‚

æœ¬åœ° state å¾ˆåˆé€‚ã€‚

Redux çš„æ–¹å¼åœ¨äºé—´æ¥çš„è§£è€¦ï¼Œä» â€œå‘ç”Ÿäº†ä»€ä¹ˆâ€ åˆ° â€œå®ƒæ˜¯æ€æ ·å˜åŒ–çš„â€ ã€‚

å®ƒæ€»æ˜¯ä¸€ç§å¥½çš„æ–¹å¼å—ï¼Ÿ ä¸ï¼Œä»–æ˜¯ä¸€ç§æŠ˜ä¸­æ–¹æ¡ˆã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç»„ä»¶ä¸­æŠ½è±¡å‡ºä¸€ä¸ª reducer ï¼š

```jsx
import React, { Component } from 'react';

const counter = (state = { value: 0 }, action) => {
  switch (action.type) {
    case 'INCREMENT':
      return { value: state.value + 1 };
    case 'DECREMENT':
      return { value: state.value - 1 };
    default:
      return state;
  }
};

class Counter extends Component {
  state = counter(undefined, {});

  dispatch(action) {
    this.setState(prevState => counter(prevState, action));
  }

  increment = () => {
    this.dispatch({ type: 'INCREMENT' });
  };

  decrement = () => {
    this.dispatch({ type: 'DECREMENT' });
  };

  render() {
    return (
      <div>
        {this.state.value}
        <button onClick={this.increment}>+</button>
        <button onClick={this.decrement}>-</button>
      </div>
    );
  }
}
```

è¯·æ³¨æ„ï¼æˆ‘ä»¬åˆšåˆšä½¿ç”¨äº† Redux å´æ²¡æœ‰æ‰§è¡Œ `npm install` ï¼Œå“‡å“¦~

çŠ¶æ€ç»„ä»¶æ˜¯å¦ä¹Ÿå¯ä»¥ä½¿ç”¨å‘¢ï¼Ÿ ä¹Ÿè®¸ä¸è¡Œã€‚é™¤éä½ æœ‰è®¡åˆ’å¹¶ä»è¿™ç§é—´æ¥æ–¹å¼ä¸­è·ç›Šã€‚æŒ‰ç…§æˆ‘ä»¬è¿™ä¸ªæ—¶ä»£çš„è¯´æ³•ï¼Œè®¡åˆ’æ˜¯å…³é”®ã€‚

Having a plan is, in the parlance of our times, the ğŸ”‘.

[Redux library](http://redux.js.org/) æœ¬èº«åªæ˜¯ä¸€ç³»åˆ—è¾…åŠ©ï¼Œå¸®åŠ© reducers å¾—åˆ°å•ä¸€çš„å…¨å±€å­˜å‚¨å¯¹è±¡ã€‚ä½ å¯ä»¥æŒ‰ç…§ä½ å–œæ¬¢çš„æ–¹å¼ï¼Œæˆ–å¤šæˆ–å°‘çš„å»ä½¿ç”¨ Reduxã€‚

ä½†å¦‚æœä½ ä»˜å‡ºäº†åŠªåŠ›ï¼Œè¦ç¡®ä¿ä½ æ”¶è·äº†å›æŠ¥ã€‚

But if you trade something off, make sure you get something in return.â˜º

### ç¿»è¯‘å¸¸ç”¨è¯æ±‡è®°å½•

frown at ä¸æ»¡ï¼ˆçš±çœ‰ï¼‰
an approach ä¸€ç§æ–¹æ³•
plain objects ç®€å•å¯¹è±¡
strong constraints ä¸¥æ ¼çº¦æŸ

boot up å¯åŠ¨(è®¡ç®—æœº)
snapshot ç®€ä»‹ï¼Œå¿«ç…§
mutation è½¬å˜
inspection æ£€æŸ¥
business logic ä¸šåŠ¡é€»è¾‘

terminal ç»ˆç«¯ï¼Œç»ˆç‚¹ç«™
approach it with caution è°¨æ…å¯¹å¾…
Itâ€™s a tradeoff æŠ˜ä¸­æ–¹æ¡ˆ
extract æå–
stateful components æœ‰çŠ¶æ€ç»„ä»¶
you can use as much å°½å¯èƒ½å¤šçš„
